name: LaTeX to PDF

on:
  push:
    branches:
      - main
    paths:
      - 'src/2 - RTB/**'

jobs:
  latex_to_pdf:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Get the newly added folder
      id: new_folder
      run: |
        # Ottieni l'ultimo commit e cerca le nuove cartelle
        new_folder=$(git diff --name-only HEAD~1 | grep '^src/2 - RTB/' | sed 's|/.*||' | sort | uniq)
        echo "NEW_FOLDER=$new_folder" >> $GITHUB_ENV

    - name: Compile LaTeX to PDF
      run: |
        # Usa la cartella appena aggiunta
        latex_folder="${{ env.NEW_FOLDER }}"
        
        # Trova il file .tex pi√π recente in questa cartella
        main_tex=$(find "$latex_folder" -type f -name "*.tex" | head -n 1)
        
        if [ -z "$main_tex" ]; then
          echo "Error: No .tex file found in the folder"
          exit 1
        fi
        
        echo "Main TeX file: $main_tex"
        
        # Compilare il file .tex con pdflatex
        pdflatex "$main_tex"
        
        # Crea la cartella PDF nella root directory, se non esiste
        mkdir -p "./PDF"
        
        # Spostare il PDF risultante nella cartella PDF nella root directory
        mv *.pdf "./PDF/"
