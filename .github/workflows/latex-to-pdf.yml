name: Compile LaTeX to PDF

on:
  push:
    branches:
      - main

  pull_request:
    branches:
      - main

jobs:
  compile_latex:
    runs-on: ubuntu-latest
    env:
      TEX_FILE: "2024-12-19_E.tex"
      OUTPUT_DIR: "PDF"
      TEXLIVE_CACHE: "/tmp/texlive-cache"

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Set up LaTeX environment
        run: |
          # Install LaTeX dependencies
          sudo apt update
          sudo apt install -y texlive-full

          # Caching texlive to speed up the next runs
          sudo apt install -y texlive-fonts-recommended texlive-latex-base
          
          # Make sure directories are available
          mkdir -p $OUTPUT_DIR

      - name: Compile LaTeX file to PDF
        run: |
          # Run latexmk to compile the LaTeX file with error handling
          echo "Compiling $TEX_FILE..."
          latexmk -pdf -shell-escape -output-directory=$OUTPUT_DIR $TEX_FILE

        continue-on-error: false  # Fail the job if compilation fails

      - name: Upload compiled PDFs as artifacts
        uses: actions/upload-artifact@v3
        with:
          name: compiled-pdf
          path: $OUTPUT_DIR/*.pdf

      - name: Cache LaTeX dependencies
        uses: actions/cache@v2
        with:
          path: $TEXLIVE_CACHE
          key: ${{ runner.os }}-texlive-${{ hashFiles('**/*.tex') }}
          restore-keys: |
            ${{ runner.os }}-texlive-
