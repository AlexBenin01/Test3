name: Compile LaTeX with shell escape enabled

on:
  pull_request:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      # Install dependencies (TeX Live, Inkscape, and others)
      - name: Set up TeX Live and Inkscape
        run: |
          sudo apt-get update
          sudo apt-get install -y texlive-full inkscape

      # Clean up old files (optional but useful)
      - name: Clean previous build files
        run: |
          rm -rf PDF/*
          rm -f *.aux *.log *.out *.toc *.lof *.lot *.fls *.fdb_latexmk

      # Compile LaTeX with shell-escape enabled
      - name: Compile LaTeX
        run: |
          latexmk -pdf -shell-escape -output-directory=PDF 2024-12-19_E.tex
        continue-on-error: false

      # Check if the PDF was successfully generated
      - name: Verify PDF creation
        run: |
          if [ ! -f "PDF/2024-12-19_E.pdf" ]; then
            echo "PDF generation failed! Please check the log."
            exit 1
          else
            echo "PDF generated successfully!"
          fi

      # Upload the generated PDF as an artifact
      - name: Upload generated PDF as artifact
        uses: actions/upload-artifact@v3
        with:
          name: compiled-pdf
          path: PDF/2024-12-19_E.pdf

      # Optional: Upload the LaTeX log files for debugging
      - name: Upload LaTeX logs for debugging
        uses: actions/upload-artifact@v3
        with:
          name: latex-logs
          path: "*.log"
