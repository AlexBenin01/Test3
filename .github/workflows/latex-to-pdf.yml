transport:
  needs: build
  runs-on: ubuntu-latest

  steps:
    # Checkout code
    - name: Checkout code
      uses: actions/checkout@v3
      with:
        persist-credentials: true
        ref: main

    # Copy PDFs from develop to main
    - name: Transport PDFs to main
      run: |
        git config --global user.name "github-actions[bot]"
        git config --global user.email "github-actions[bot]@users.noreply.github.com"
        
        # Fetch the latest changes from develop without merging
        git fetch origin develop:develop
        
        # Se la directory 'PDF' esiste in develop
        if [ -d "PDF" ]; then
          # Trova tutti i file PDF sotto 'PDF/2 - RTB/' e spostali nella struttura di destinazione in '2 - RTB/'
          find PDF/2\ -\ RTB/ -type f -name "*.pdf" | while read pdf_path; do
            # Calcola il percorso relativo rispetto alla cartella 'PDF/'
            relative_path=$(echo "$pdf_path" | sed 's|PDF/||')
            # La destinazione diventa la stessa struttura, ma in '2 - RTB/'
            target_path="2 - RTB/$relative_path"
            # Crea eventuali cartelle nella destinazione
            mkdir -p "$(dirname "$target_path")"
            # Copia il PDF nella nuova destinazione
            cp "$pdf_path" "$target_path"
          done
          
          # Aggiungi i file PDF copiati alla commit
          git add "2 - RTB/"
          git commit -m "Transport PDFs from develop to main"
          git push origin main
        else
          echo "No PDFs found to transport."
        fi
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
