- name: Find the most recently modified file under src/
  id: find_latest_file
  run: |
    # Mostra l'output del log git per il debug
    echo "Running git log to find the most recently modified file..."
    git log --name-only --pretty=format:"%H %ad" --date=iso
    
    # Trova il file più recentemente modificato sotto src/
    latest_file=$(git log --name-only --pretty=format:"%H %ad" --date=iso | grep "^src/" | sort -r | head -n 1 | awk '{$1=""; print substr($0,2)}')

    # Mostra il file trovato per debug
    echo "Latest file found: $latest_file"

    # Se il file si trova nelle cartelle 'images' o 'contents', risali alla cartella principale
    if [[ "$latest_file" == *"/images"* ]] || [[ "$latest_file" == *"/contents"* ]]; then
      echo "The latest modification is inside 'images' or 'contents'. Using the parent folder instead."
      latest_file=$(dirname "$latest_file")
    fi

    # Se non è stato trovato alcun file, fermiamo il processo
    if [ -z "$latest_file" ]; then
      echo "Error: No valid file found in src/"
      exit 1
    fi

    echo "Final latest file or folder: $latest_file"
    echo "LATEST_FILE=$latest_file" >> $GITHUB_ENV
